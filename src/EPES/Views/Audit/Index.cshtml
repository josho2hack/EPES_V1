@using Microsoft.AspNetCore.Identity
@using System.Globalization
@model EPES.ViewModels.ResultViewModel
@inject UserManager<ApplicationUser> UserManager

@{
    ViewData["Title"] = "ตรวจสอบและยืนยัน";
    var user = await UserManager.GetUserAsync(User);
    ScoreDraft sd = null;
    DataForEvaluation de = null;
    decimal sumOfData = 0;
    decimal sumOfExpect = 0;
}

<link href="~/css/devextreme/dx.common.css" rel="stylesheet" />
<link href="~/css/devextreme/dx.light.css" rel="stylesheet" />
@*<script src="~/js/devextreme/jquery.js"></script>*@
<script src="~/js/devextreme/cldr.js"></script>
<script src="~/js/devextreme/cldr/event.js"></script>
<script src="~/js/devextreme/cldr/supplemental.js"></script>
<script src="~/js/devextreme/cldr/unresolved.js"></script>
<script src="~/js/devextreme/globalize.js"></script>
<script src="~/js/devextreme/globalize/message.js"></script>
<script src="~/js/devextreme/globalize/number.js"></script>
<script src="~/js/devextreme/globalize/currency.js"></script>
<script src="~/js/devextreme/globalize/date.js"></script>
<!-- Uncomment to enable the client-side export feature -->
<!-- script src="~/js/devextreme/jszip.js"></script -->
<!-- Uncomment to provide geo-data for the VectorMap control -->
<!-- script src="~/js/devextreme/vectormap-data/world.js"></script -->
<script src="~/js/devextreme/dx.all.js"></script>
<script src="~/js/devextreme/aspnet/dx.aspnet.mvc.js"></script>
<script src="~/js/devextreme/aspnet/dx.aspnet.data.js"></script>

<div class="container-fluid">
    <h1 class="h3 mb-2 text-gray-800">ตรวจสอบ/ยืนยัน ผลการปฏิบัติราชการ</h1>
    <p class="mb-4">ตรวจสอบ/ยืนยัน</p>
    <form asp-action="Index">
        <div class="row justify-content-between">
            <div class="col-md-5">
                <div class="row">
                    <label class="col-form-label col-md-3 text-md-right">หน่วยงาน: </label>
                    @if (User.IsInRole("Admin") || User.IsInRole("Special") || User.IsInRole("Manager")
                       || (User.IsInRole("User") && user.OfficeId.Substring(2, 6) == "000000") || (user.approver == true && user.OfficeId.Substring(5, 3) == "000"))
                    {
                        <select name="selectoffice" class="form-control col-md-9" asp-items="ViewBag.OfficeCode" onchange="this.form.submit()">
                            <option value="">เลือกหน่วยงาน</option>
                        </select>
                    }
                    else
                    {
                        <select name="selectoffice" class="form-control col-md-7" asp-items="ViewBag.OfficeCode" onchange="this.form.submit()" disabled>
                            <option value="">เลือกหน่วยงาน</option>
                        </select>
                    }
                </div>
            </div>
            <div class="col-md-3">
                <div class="row">
                    <label class="col-form-label col-md-6 text-md-right">ปีงบประมาณ: </label>
                    <select asp-for="yearPoint" class="form-control col-md-6" onchange="this.form.submit()">
                        <option value="-1">
                            @{
                                if (DateTime.Now.Month == 10 || DateTime.Now.Month == 11 || DateTime.Now.Month == 12)
                                {
                                    @DateTime.Now.ToString("yyyy");
                                }
                                else
                                {
                                    @DateTime.Now.AddYears(-1).ToString("yyyy");
                                }
                            }
                        </option>
                        <option value="0">
                            @{
                                if (DateTime.Now.Month == 10 || DateTime.Now.Month == 11 || DateTime.Now.Month == 12)
                                {
                                    @DateTime.Now.AddYears(1).ToString("yyyy");
                                }
                                else
                                {
                                    @DateTime.Now.ToString("yyyy");
                                }
                            }
                        </option>
                        @*<option value="1">
                                @{
                                    if (DateTime.Now.Month == 10 || DateTime.Now.Month == 11 || DateTime.Now.Month == 12)
                                    {
                                        @DateTime.Now.AddYears(2).ToString("yyyy");
                                    }
                                    else
                                    {
                                        @DateTime.Now.AddYears(1).ToString("yyyy");
                                    }
                                }
                            </option>*@
                    </select>
                </div>
            </div>
            <div class="col-md-4">
                <div class="row">
                    <label class="col-form-label col-md-5 text-md-right">รายงานประจำเดือน: </label>
                    <select name="month" class="form-control col-md-7" asp-items="ViewBag.Month" onchange="this.form.submit()"></select>
                </div>
            </div>
        </div>
    </form>
    @(Html.DevExtreme().Popup()
           .ID("detail-popup")
           .ElementAttr("class", "popup")
           .Width(700)
           .Height(600)
           .ShowTitle(true)
           .Title("รายละเอียด")
           .Visible(false)
           .DragEnabled(false)
           .CloseOnOutsideClick(true)
     )
    <!-- Plan A -->
    @if (Model.pointA != null)
    {
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">แผนงานตามนโยบายจากผู้บริหาร (Top - Down: A)</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <form asp-action="Update" method="post">
                        <table class="table table-bordered" id="EPEStableA" style="width:100%;" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>
                                        ที่
                                    </th>
                                    <th>
                                        ตัวชี้วัด
                                    </th>
                                    <th>
                                        <i class="fas fa-percent" title="น้ำหนักร้อยละ"></i>
                                    </th>
                                    <th>
                                        คะแนน
                                    </th>
                                    <th>
                                        เห็นชอบ
                                    </th>
                                    <th>
                                        ความเห็น
                                    </th>
                                    <th>
                                        รายละเอียด
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.pointA.Count(); i++)
                                {
                                    sumOfExpect = 0;
                                    sumOfData = 0;
                                    <tr>
                                        <td>
                                            @if (Model.pointA[i].SubPoint != 0)
                                            {
                                                @Model.pointA[i].Point@:.@Model.pointA[i].SubPoint
                                            }
                                            else
                                            {
                                                @Model.pointA[i].Point
                                            }
                                        </td>
                                        <td>
                                            @Model.pointA[i].Name
                                            @foreach (var item in @Model.pointA[i].DataForEvaluations)
                                            {
                                                if (item.Month == Model.month && item.OfficeId == Model.pointA[i].OwnerOfficeId)
                                                {
                                                    de = item;
                                                }
                                                if (Model.pointA[i].Unit != UnitOfPoint.ระดับ)
                                                {
                                                    if (Model.month >= 10)
                                                    {
                                                        if (item.Month <= Model.month && item.Month >= 10)
                                                        {
                                                            if (Model.pointA[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (item.Month == 10 || item.Month == 11 || item.Month == 12)
                                                        {
                                                            if (Model.pointA[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                        if (item.Month <= Model.month)
                                                        {
                                                            if (Model.pointA[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }

                                                }
                                            }
                                            <input type="hidden" name="UpdateData[@i].Id" value=@de?.Id />
                                            <input type="hidden" name="UpdateData[@i].poeid" value=@Model.pointA[i].Id />
                                            <input type="hidden" name="UpdateData[@i].officeid" value=@Model.pointA[i].OwnerOfficeId />
                                            @foreach (var item in @Model.pointA[i].ScoreDrafts)
                                            {
                                                if (item.LastMonth == Model.month && item.OfficeId == Model.pointA[i].OwnerOfficeId)
                                                {
                                                    sd = item;
                                                }
                                            }
                                        </td>
                                        <td>
                                            @if (!Model.pointA[i].HasSub)
                                            {
                                                @Model.pointA[i].Weight.ToString("N2")
                                            }
                                        </td>
                                        <td>
                                            @*@string.Format("{0:N4}", sd?.ScoreValue)*@
                                            @if (!Model.pointA[i].HasSub)
                                            {
                                                @sd?.ScoreValue.ToString("N4")
                                            }
                                        </td>
                                        @if (@Model.pointA[i].HasSub)
                                        {
                                            <td><input type="hidden" name="UpdateData[@i].hasSub" value="true" /></td>
                                            <td></td>
                                            <td></td>
                                        }
                                        else
                                        {
                                            if (de?.Approve == Approve.รอพิจารณา)
                                            {

                                                @if (user.OfficeId.Substring(0, 3) == "000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-danger">รอพิจารณา</label>
                                                        </div>
                                                    </td>
                                                    <td></td>
                                                }

                                            }
                                            else if (de?.Approve == Approve.หัวหน้าหน่วยงานอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000")
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-info">สภ. เห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.กองผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000" && user.OfficeId != "00013000")
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                                else if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId == "00013000"))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.ผษ_อนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-primary">กองกำกับเห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.ผษ_อนุมัติ)
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label text-success">กรมเห็นชอบแล้ว</label>
                                                    </div>
                                                </td>
                                                <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 readonly /></td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label">ยังไม่บันทึกข้อมูล</label>
                                                    </div>
                                                </td>
                                                <td></td>
                                            }
                                            <td>
                                                @(Html.DevExtreme().Button()
                                                                //.ElementAttr("class", "button-info")
                                                                .Text("รายละเอียด")
                                                                .OnClick(@<text>
                                                                            function showInfo(data) {
                                                                            var popup = $("#detail-popup").dxPopup("instance");
                                                                            popup.option("contentTemplate", $("@("#popup-template-" + Model.pointA[i].Id)"));
                                                                            popup.show();
                                                                            }
                                                                </text>)
                                                )

                                                @using (Html.DevExtreme().NamedTemplate("popup-template-" + Model.pointA[i].Id))
                                                {
                                                    <form id="@("form" + Model.pointA[i].Id)" method="post" action="Audit\SaveAudit">
                                                        <dl class="row">
                                                            <dt class="col-3">หมายเลขตัวชี้วัด</dt>
                                                            <dd class="col-9">
                                                                @if (Model.pointA[i].SubPoint != 0)
                                                                {
                                                                    @Model.pointA[i].Point@:.@Model.pointA[i].SubPoint
                                                                }
                                                                else
                                                                {
                                                                    @Model.pointA[i].Point
                                                                }
                                                            </dd>
                                                            <dt class="col-3">ชื่อ</dt>
                                                            <dd class="col-9">
                                                                @Model.pointA[i].Name
                                                            </dd>
                                                            <dt class="col-3">น้ำหนัก</dt>
                                                            <dd class="col-9">
                                                                @Model.pointA[i].Weight.ToString("N2") %
                                                            </dd>
                                                            <dt class="col-3">เป้าหมาย</dt>
                                                            @if (Model.pointA[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" disabled />
                                                                    }

                                                                </dd>
                                                                <dt class="col-3">เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfExpect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfData)
                                                                </dd>
                                                                <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @if (sumOfExpect != 0)
                                                                    {
                                                                        @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                    }
                                                                    else
                                                                    {
                                                                        <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                    }
                                                                </dd>
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    }
                                                                </dd>
                                                            }
                                                            else
                                                            {
                                                                if (Model.pointA[i].Unit == UnitOfPoint.ระดับ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointA[i].Rounds.Count == 2))
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointA[i].Rounds[1].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointA[i].Rounds[1].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointA[i].Rounds[1].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointA[i].Rounds[1].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointA[i].Rounds[1].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointA[i].Rounds[0].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointA[i].Rounds[0].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointA[i].Rounds[0].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointA[i].Rounds[0].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointA[i].Rounds[0].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            list.Add(new { Value = 1, Detail = "1." + Model.pointA[i].Rounds[0].DetailRate1 });
                                                                            list.Add(new { Value = 2, Detail = "2." + Model.pointA[i].Rounds[0].DetailRate2 });
                                                                            list.Add(new { Value = 3, Detail = "3." + Model.pointA[i].Rounds[0].DetailRate3 });
                                                                            list.Add(new { Value = 4, Detail = "4." + Model.pointA[i].Rounds[0].DetailRate4 });
                                                                            list.Add(new { Value = 5, Detail = "5." + Model.pointA[i].Rounds[0].DetailRate5 });

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointA[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointA[i].Rounds[1].DetailRate1 });
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointA[i].Rounds[1].DetailRate2 });
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointA[i].Rounds[1].DetailRate3 });
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointA[i].Rounds[1].DetailRate4 });
                                                                                list.Add(new { Value = 5, Detail = "5." + Model.pointA[i].Rounds[1].DetailRate5 });
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                        }

                                                                    </dd>
                                                                }
                                                                if (Model.pointA[i].Unit == UnitOfPoint.ระดับ_ร้อยละ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointA[i].Rounds.Count == 2))
                                                                    {
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointA[i].Rounds[1].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointA[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointA[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointA[i].Rounds[1].DetailRate1 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointA[i].Rounds[1].DetailRate2  <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointA[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                        }
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointA[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointA[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[1].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointA[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointA[i].Rounds[1].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointA[i].Rounds[0].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointA[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointA[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointA[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointA[i].Rounds[0].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointA[i].Rounds[0].DetailRate3<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointA[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointA[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointA[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointA[i].Rounds[0].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointA[i].Rounds[0].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointA[i].Rounds[0].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            if (Model.pointA[i].Rounds[0].LevelNumber >= 1)
                                                                            {
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointA[i].Rounds[0].DetailRate1 });

                                                                            }
                                                                            if (Model.pointA[i].Rounds[0].LevelNumber >= 2)
                                                                            {
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointA[i].Rounds[0].DetailRate2 });
                                                                            }
                                                                            if (Model.pointA[i].Rounds[0].LevelNumber >= 3)
                                                                            {
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointA[i].Rounds[0].DetailRate3 });
                                                                            }
                                                                            if (Model.pointA[i].Rounds[0].LevelNumber >= 4)
                                                                            {
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointA[i].Rounds[0].DetailRate4 });
                                                                            }

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointA[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                if (Model.pointA[i].Rounds[1].LevelNumber >= 1)
                                                                                {
                                                                                    list.Add(new { Value = 1, Detail = "1." + Model.pointA[i].Rounds[1].DetailRate1 });
                                                                                }
                                                                                if (Model.pointA[i].Rounds[1].LevelNumber >= 2)
                                                                                {
                                                                                    list.Add(new { Value = 2, Detail = "2." + Model.pointA[i].Rounds[1].DetailRate2 });
                                                                                }
                                                                                if (Model.pointA[i].Rounds[1].LevelNumber >= 3)
                                                                                {
                                                                                    list.Add(new { Value = 3, Detail = "3." + Model.pointA[i].Rounds[1].DetailRate3 });
                                                                                }
                                                                                if (Model.pointA[i].Rounds[1].LevelNumber >= 4)
                                                                                {
                                                                                    list.Add(new { Value = 4, Detail = "4." + Model.pointA[i].Rounds[1].DetailRate4 });
                                                                                }
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" readonly />
                                                                        }

                                                                    </dd>
                                                                    <dt class="col-3">เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfExpect)
                                                                    </dd>
                                                                    <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfData)
                                                                    </dd>
                                                                    <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @if (sumOfExpect != 0)
                                                                        {
                                                                            @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                        }
                                                                    </dd>
                                                                }
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    </dd>
                                                                }
                                                                else
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    </dd>
                                                                }
                                                                @if (de?.AttachFile != null)
                                                                {
                                                                    <dt class="col-3">ไฟล์แนบ</dt>
                                                                    <dd class="col-9">
                                                                        <a href="~/attach_files/@de?.AttachFile" target="_blank"><i class="fas fa-file-pdf fa-2x"></i></a>
                                                                    </dd>
                                                                }
                                                            } @* End ระดับ - ระดับ-ร้อยละ*@
                                                        </dl>
                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointA[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                                .ID("button")
                                                                .Text("บันทึก")
                                                                .Type(ButtonType.Success)
                                                                .UseSubmitBehavior(true)
                                                            )
                                                        }
                                                        else
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                               .ID("button")
                                                               .Text("บันทึก")
                                                               .Type(ButtonType.Normal)
                                                               .UseSubmitBehavior(false)
                                                            )
                                                        }
                                                        <input type="hidden" name="UpdateData.Id" value=@de?.Id />
                                                        <input asp-for="yearPoint" class="form-control" hidden />
                                                        <input asp-for="month" class="form-control" hidden />
                                                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                                                    </form>
                                                }
                                            </td>
                                        }
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr><th colspan="2" style="text-align:right">รวม</th><th></th><th></th><th></th><th></th><th></th></tr>
                            </tfoot>
                        </table>
                        <input asp-for="yearPoint" class="form-control" hidden />
                        <input asp-for="month" class="form-control" hidden />
                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                        @if (User.IsInRole("Admin") || User.IsInRole("Special") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000")
                            || (user.approver == true && user.OfficeId.Substring(5, 3) == "000"))
                        {
                            <input type="submit" name="Update" value="บันทึก" class="btn btn-primary" />
                        }
                        <a asp-area="" asp-controller="Results" asp-action="Index" asp-route-yearPoint="@Model.yearPoint" asp-route-selectoffice="@ViewBag.selectoffice" asp-route-month="@Model.month" class="btn btn-secondary">ยกเลิก</a>
                    </form>
                </div>
            </div>
        </div>
    }
    <!-- Plan B -->
    @if (Model.pointB != null)
    {
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">แผนงานตามนโยบายที่ถ่ายทอดไปยังหน่วยปฏิบัติ (Top - Down: B)</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <form asp-action="Update" method="post">
                        <table class="table table-bordered" id="EPEStableB" style="width:100%;" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>
                                        ที่
                                    </th>
                                    <th>
                                        ตัวชี้วัด
                                    </th>
                                    <th>
                                        <i class="fas fa-percent" title="น้ำหนักร้อยละ"></i>
                                    </th>
                                    <th>
                                        คะแนน
                                    </th>
                                    <th>
                                        เห็นชอบ
                                    </th>
                                    <th>
                                        ความเห็น
                                    </th>
                                    <th>
                                        รายละเอียด
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.pointB.Count(); i++)
                                {
                                    sumOfExpect = 0;
                                    sumOfData = 0;
                                    <tr>
                                        <td>
                                            @if (Model.pointB[i].SubPoint != 0)
                                            {
                                                @Model.pointB[i].Point@:.@Model.pointB[i].SubPoint
                                            }
                                            else
                                            {
                                                @Model.pointB[i].Point
                                            }
                                        </td>
                                        <td>
                                            @Model.pointB[i].Name
                                            @foreach (var item in @Model.pointB[i].DataForEvaluations)
                                            {
                                                if (item.Month == Model.month && item.OfficeId == Model.pointB[i].OwnerOfficeId)
                                                {
                                                    de = item;
                                                }
                                                if (Model.pointB[i].Unit != UnitOfPoint.ระดับ)
                                                {
                                                    if (Model.month >= 10)
                                                    {
                                                        if (item.Month <= Model.month && item.Month >= 10)
                                                        {
                                                            if (Model.pointB[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (item.Month == 10 || item.Month == 11 || item.Month == 12)
                                                        {
                                                            if (Model.pointB[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                        if (item.Month <= Model.month)
                                                        {
                                                            if (Model.pointB[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                }
                                            }
                                            <input type="hidden" name="UpdateData[@i].Id" value=@de?.Id />
                                            <input type="hidden" name="UpdateData[@i].poeid" value=@Model.pointB[i].Id />
                                            <input type="hidden" name="UpdateData[@i].officeid" value=@Model.pointB[i].OwnerOfficeId />
                                            @foreach (var item in @Model.pointB[i].ScoreDrafts)
                                            {
                                                if (item.LastMonth == Model.month && item.OfficeId == Model.pointB[i].OwnerOfficeId)
                                                {
                                                    sd = item;
                                                }
                                            }
                                        </td>
                                        <td>
                                            @if (!Model.pointB[i].HasSub)
                                            {
                                                @Model.pointB[i].Weight.ToString("N2")
                                            }
                                        </td>
                                        <td>
                                            @*@string.Format("{0:N4}", sd?.ScoreValue)*@
                                            @if (!Model.pointB[i].HasSub)
                                            {
                                                @sd?.ScoreValue.ToString("N4")
                                            }
                                        </td>
                                        @if (@Model.pointB[i].HasSub)
                                        {
                                            <td><input type="hidden" name="UpdateData[@i].hasSub" value="true" /></td>
                                            <td></td>
                                            <td></td>
                                        }
                                        else
                                        {
                                            if (de?.Approve == Approve.รอพิจารณา)
                                            {

                                                @if (user.OfficeId.Substring(0, 3) == "000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-danger">รอพิจารณา</label>
                                                        </div>
                                                    </td>
                                                    <td></td>
                                                }

                                            }
                                            else if (de?.Approve == Approve.หัวหน้าหน่วยงานอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000")
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-info">สภ. เห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.กองผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000" && user.OfficeId != "00013000")
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                                else if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId == "00013000"))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.ผษ_อนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-primary">กองกำกับเห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.ผษ_อนุมัติ)
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label text-success">กรมเห็นชอบแล้ว</label>
                                                    </div>
                                                </td>
                                                <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 readonly /></td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label">ยังไม่บันทึกข้อมูล</label>
                                                    </div>
                                                </td>
                                                <td></td>
                                            }
                                            <td>
                                                @(Html.DevExtreme().Button()
                                                                //.ElementAttr("class", "button-info")
                                                                .Text("รายละเอียด")
                                                                .OnClick(@<text>
                                                                            function showInfo(data) {
                                                                            var popup = $("#detail-popup").dxPopup("instance");
                                                                            popup.option("contentTemplate", $("@("#popup-template-" + Model.pointB[i].Id)"));
                                                                            popup.show();
                                                                            }
                                                                </text>)
                                                )

                                                @using (Html.DevExtreme().NamedTemplate("popup-template-" + Model.pointB[i].Id))
                                                {
                                                    <form id="@("form" + Model.pointB[i].Id)" method="post" action="Audit\SaveAudit">
                                                        <dl class="row">
                                                            <dt class="col-3">หมายเลขตัวชี้วัด</dt>
                                                            <dd class="col-9">
                                                                @if (Model.pointB[i].SubPoint != 0)
                                                                {
                                                                    @Model.pointB[i].Point@:.@Model.pointB[i].SubPoint
                                                                }
                                                                else
                                                                {
                                                                    @Model.pointB[i].Point
                                                                }
                                                            </dd>
                                                            <dt class="col-3">ชื่อ</dt>
                                                            <dd class="col-9">
                                                                @Model.pointB[i].Name
                                                            </dd>
                                                            <dt class="col-3">น้ำหนัก</dt>
                                                            <dd class="col-9">
                                                                @Model.pointB[i].Weight.ToString("N2") %
                                                            </dd>
                                                            <dt class="col-3">เป้าหมาย</dt>
                                                            @if (Model.pointB[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" disabled />
                                                                    }

                                                                </dd>
                                                                <dt class="col-3">เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfExpect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfData)
                                                                </dd>
                                                                <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @if (sumOfExpect != 0)
                                                                    {
                                                                        @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                    }
                                                                    else
                                                                    {
                                                                        <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                    }
                                                                </dd>
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    }
                                                                </dd>
                                                            }
                                                            else
                                                            {
                                                                if (Model.pointB[i].Unit == UnitOfPoint.ระดับ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointB[i].Rounds.Count == 2))
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointB[i].Rounds[1].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointB[i].Rounds[1].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointB[i].Rounds[1].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointB[i].Rounds[1].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointB[i].Rounds[1].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointB[i].Rounds[0].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointB[i].Rounds[0].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointB[i].Rounds[0].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointB[i].Rounds[0].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointB[i].Rounds[0].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            list.Add(new { Value = 1, Detail = "1." + Model.pointB[i].Rounds[0].DetailRate1 });
                                                                            list.Add(new { Value = 2, Detail = "2." + Model.pointB[i].Rounds[0].DetailRate2 });
                                                                            list.Add(new { Value = 3, Detail = "3." + Model.pointB[i].Rounds[0].DetailRate3 });
                                                                            list.Add(new { Value = 4, Detail = "4." + Model.pointB[i].Rounds[0].DetailRate4 });
                                                                            list.Add(new { Value = 5, Detail = "5." + Model.pointB[i].Rounds[0].DetailRate5 });

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointB[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointB[i].Rounds[1].DetailRate1 });
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointB[i].Rounds[1].DetailRate2 });
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointB[i].Rounds[1].DetailRate3 });
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointB[i].Rounds[1].DetailRate4 });
                                                                                list.Add(new { Value = 5, Detail = "5." + Model.pointB[i].Rounds[1].DetailRate5 });
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                        }

                                                                    </dd>
                                                                }
                                                                if (Model.pointB[i].Unit == UnitOfPoint.ระดับ_ร้อยละ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointB[i].Rounds.Count == 2))
                                                                    {
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointB[i].Rounds[1].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointB[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointB[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointB[i].Rounds[1].DetailRate1 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointB[i].Rounds[1].DetailRate2  <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointB[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                        }
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointB[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointB[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[1].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointB[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointB[i].Rounds[1].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointB[i].Rounds[0].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointB[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointB[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointB[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointB[i].Rounds[0].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointB[i].Rounds[0].DetailRate3<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointB[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointB[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointB[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointB[i].Rounds[0].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointB[i].Rounds[0].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointB[i].Rounds[0].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            if (Model.pointB[i].Rounds[0].LevelNumber >= 1)
                                                                            {
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointB[i].Rounds[0].DetailRate1 });

                                                                            }
                                                                            if (Model.pointB[i].Rounds[0].LevelNumber >= 2)
                                                                            {
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointB[i].Rounds[0].DetailRate2 });
                                                                            }
                                                                            if (Model.pointB[i].Rounds[0].LevelNumber >= 3)
                                                                            {
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointB[i].Rounds[0].DetailRate3 });
                                                                            }
                                                                            if (Model.pointB[i].Rounds[0].LevelNumber >= 4)
                                                                            {
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointB[i].Rounds[0].DetailRate4 });
                                                                            }

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointB[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                if (Model.pointB[i].Rounds[1].LevelNumber >= 1)
                                                                                {
                                                                                    list.Add(new { Value = 1, Detail = "1." + Model.pointB[i].Rounds[1].DetailRate1 });
                                                                                }
                                                                                if (Model.pointB[i].Rounds[1].LevelNumber >= 2)
                                                                                {
                                                                                    list.Add(new { Value = 2, Detail = "2." + Model.pointB[i].Rounds[1].DetailRate2 });
                                                                                }
                                                                                if (Model.pointB[i].Rounds[1].LevelNumber >= 3)
                                                                                {
                                                                                    list.Add(new { Value = 3, Detail = "3." + Model.pointB[i].Rounds[1].DetailRate3 });
                                                                                }
                                                                                if (Model.pointB[i].Rounds[1].LevelNumber >= 4)
                                                                                {
                                                                                    list.Add(new { Value = 4, Detail = "4." + Model.pointB[i].Rounds[1].DetailRate4 });
                                                                                }
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" readonly />
                                                                        }

                                                                    </dd>
                                                                    <dt class="col-3">เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfExpect)
                                                                    </dd>
                                                                    <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfData)
                                                                    </dd>
                                                                    <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @if (sumOfExpect != 0)
                                                                        {
                                                                            @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                        }
                                                                    </dd>
                                                                }
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    </dd>
                                                                }
                                                                else
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    </dd>
                                                                }
                                                                @if (de?.AttachFile != null)
                                                                {
                                                                    <dt class="col-3">ไฟล์แนบ</dt>
                                                                    <dd class="col-9">
                                                                        <a href="~/attach_files/@de?.AttachFile" target="_blank"><i class="fas fa-file-pdf fa-2x"></i></a>
                                                                    </dd>
                                                                }
                                                            } @* End ระดับ - ระดับ-ร้อยละ*@
                                                        </dl>
                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointB[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                                .ID("button")
                                                                .Text("บันทึก")
                                                                .Type(ButtonType.Success)
                                                                .UseSubmitBehavior(true)
                                                            )
                                                        }
                                                        else
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                               .ID("button")
                                                               .Text("บันทึก")
                                                               .Type(ButtonType.Normal)
                                                               .UseSubmitBehavior(false)
                                                            )
                                                        }
                                                        <input type="hidden" name="UpdateData.Id" value=@de?.Id />
                                                        <input asp-for="yearPoint" class="form-control" hidden />
                                                        <input asp-for="month" class="form-control" hidden />
                                                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                                                    </form>
                                                }
                                            </td>
                                        }
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr><th colspan="2" style="text-align:right">รวม</th><th></th><th></th><th></th><th></th><th></th></tr>
                            </tfoot>
                        </table>
                        <input asp-for="yearPoint" class="form-control" hidden />
                        <input asp-for="month" class="form-control" hidden />
                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                        @if (User.IsInRole("Admin") || User.IsInRole("Special") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000")
                            || (user.approver == true && user.OfficeId.Substring(5, 3) == "000"))
                        {
                            <input type="submit" name="Update" value="บันทึก" class="btn btn-primary" />
                        }
                        <a asp-area="" asp-controller="Results" asp-action="Index" asp-route-yearPoint="@Model.yearPoint" asp-route-selectoffice="@ViewBag.selectoffice" asp-route-month="@Model.month" class="btn btn-secondary">ยกเลิก</a>
                    </form>
                </div>
            </div>
        </div>
    }
    <!-- Plan C แผนงานตามความต้องการของหน่วยงาน (Bottom - Up: C)-->
    @if (Model.pointC != null)
    {
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">แผนงานตามความต้องการของหน่วยงาน (Bottom - Up: C)</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <form asp-action="Update" method="post">
                        <table class="table table-bordered" id="EPEStableC" style="width:100%;" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>
                                        ที่
                                    </th>
                                    <th>
                                        ตัวชี้วัด
                                    </th>
                                    <th>
                                        <i class="fas fa-percent" title="น้ำหนักร้อยละ"></i>
                                    </th>
                                    <th>
                                        คะแนน
                                    </th>
                                    <th>
                                        เห็นชอบ
                                    </th>
                                    <th>
                                        ความเห็น
                                    </th>
                                    <th>
                                        รายละเอียด
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.pointC.Count(); i++)
                                {
                                    sumOfExpect = 0;
                                    sumOfData = 0;
                                    <tr>
                                        <td>
                                            @if (Model.pointC[i].SubPoint != 0)
                                            {
                                                @Model.pointC[i].Point@:.@Model.pointC[i].SubPoint
                                            }
                                            else
                                            {
                                                @Model.pointC[i].Point
                                            }
                                        </td>
                                        <td>
                                            @Model.pointC[i].Name
                                            @foreach (var item in @Model.pointC[i].DataForEvaluations)
                                            {
                                                if (item.Month == Model.month && item.OfficeId == Model.pointC[i].OwnerOfficeId)
                                                {
                                                    de = item;
                                                }
                                                if (Model.pointC[i].Unit != UnitOfPoint.ระดับ)
                                                {
                                                    if (Model.month >= 10)
                                                    {
                                                        if (item.Month <= Model.month && item.Month >= 10)
                                                        {
                                                            if (Model.pointC[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (item.Month == 10 || item.Month == 11 || item.Month == 12)
                                                        {
                                                            if (Model.pointC[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                        if (item.Month <= Model.month)
                                                        {
                                                            if (Model.pointC[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                }
                                            }
                                            <input type="hidden" name="UpdateData[@i].Id" value=@de?.Id />
                                            <input type="hidden" name="UpdateData[@i].poeid" value=@Model.pointC[i].Id />
                                            <input type="hidden" name="UpdateData[@i].officeid" value=@Model.pointC[i].OwnerOfficeId />
                                            @foreach (var item in @Model.pointC[i].ScoreDrafts)
                                            {
                                                if (item.LastMonth == Model.month && item.OfficeId == Model.pointC[i].OwnerOfficeId)
                                                {
                                                    sd = item;
                                                }
                                            }
                                        </td>
                                        <td>
                                            @if (!Model.pointC[i].HasSub)
                                            {
                                                @Model.pointC[i].Weight.ToString("N2")
                                            }
                                        </td>
                                        <td>
                                            @*@string.Format("{0:N4}", sd?.ScoreValue)*@
                                            @if (!Model.pointC[i].HasSub)
                                            {
                                                @sd?.ScoreValue.ToString("N4")
                                            }
                                        </td>
                                        @if (@Model.pointC[i].HasSub)
                                        {
                                            <td><input type="hidden" name="UpdateData[@i].hasSub" value="true" /></td>
                                            <td></td>
                                            <td></td>
                                        }
                                        else
                                        {
                                            if (de?.Approve == Approve.รอพิจารณา)
                                            {

                                                @if (user.OfficeId.Substring(0, 3) == "000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-danger">รอพิจารณา</label>
                                                        </div>
                                                    </td>
                                                    <td></td>
                                                }

                                            }
                                            else if (de?.Approve == Approve.หัวหน้าหน่วยงานอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000")
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-info">สภ. เห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.กองผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000" && user.OfficeId != "00013000")
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                                else if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId == "00013000"))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.ผษ_อนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-primary">กองกำกับเห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.ผษ_อนุมัติ)
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label text-success">กรมเห็นชอบแล้ว</label>
                                                    </div>
                                                </td>
                                                <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 readonly /></td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label">ยังไม่บันทึกข้อมูล</label>
                                                    </div>
                                                </td>
                                                <td></td>
                                            }
                                            <td>
                                                @(Html.DevExtreme().Button()
                                                                //.ElementAttr("class", "button-info")
                                                                .Text("รายละเอียด")
                                                                .OnClick(@<text>
                                                                            function showInfo(data) {
                                                                            var popup = $("#detail-popup").dxPopup("instance");
                                                                            popup.option("contentTemplate", $("@("#popup-template-" + Model.pointC[i].Id)"));
                                                                            popup.show();
                                                                            }
                                                                </text>)
                                                )

                                                @using (Html.DevExtreme().NamedTemplate("popup-template-" + Model.pointC[i].Id))
                                                {
                                                    <form id="@("form" + Model.pointC[i].Id)" method="post" action="Audit\SaveAudit">
                                                        <dl class="row">
                                                            <dt class="col-3">หมายเลขตัวชี้วัด</dt>
                                                            <dd class="col-9">
                                                                @if (Model.pointC[i].SubPoint != 0)
                                                                {
                                                                    @Model.pointC[i].Point@:.@Model.pointC[i].SubPoint
                                                                }
                                                                else
                                                                {
                                                                    @Model.pointC[i].Point
                                                                }
                                                            </dd>
                                                            <dt class="col-3">ชื่อ</dt>
                                                            <dd class="col-9">
                                                                @Model.pointC[i].Name
                                                            </dd>
                                                            <dt class="col-3">น้ำหนัก</dt>
                                                            <dd class="col-9">
                                                                @Model.pointC[i].Weight.ToString("N2") %
                                                            </dd>
                                                            <dt class="col-3">เป้าหมาย</dt>
                                                            @if (Model.pointC[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" disabled />
                                                                    }

                                                                </dd>
                                                                <dt class="col-3">เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfExpect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfData)
                                                                </dd>
                                                                <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @if (sumOfExpect != 0)
                                                                    {
                                                                        @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                    }
                                                                    else
                                                                    {
                                                                        <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                    }
                                                                </dd>
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    }
                                                                </dd>
                                                            }
                                                            else
                                                            {
                                                                if (Model.pointC[i].Unit == UnitOfPoint.ระดับ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointC[i].Rounds.Count == 2))
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointC[i].Rounds[1].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointC[i].Rounds[1].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointC[i].Rounds[1].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointC[i].Rounds[1].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointC[i].Rounds[1].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointC[i].Rounds[0].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointC[i].Rounds[0].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointC[i].Rounds[0].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointC[i].Rounds[0].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointC[i].Rounds[0].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            list.Add(new { Value = 1, Detail = "1." + Model.pointC[i].Rounds[0].DetailRate1 });
                                                                            list.Add(new { Value = 2, Detail = "2." + Model.pointC[i].Rounds[0].DetailRate2 });
                                                                            list.Add(new { Value = 3, Detail = "3." + Model.pointC[i].Rounds[0].DetailRate3 });
                                                                            list.Add(new { Value = 4, Detail = "4." + Model.pointC[i].Rounds[0].DetailRate4 });
                                                                            list.Add(new { Value = 5, Detail = "5." + Model.pointC[i].Rounds[0].DetailRate5 });

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointC[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointC[i].Rounds[1].DetailRate1 });
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointC[i].Rounds[1].DetailRate2 });
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointC[i].Rounds[1].DetailRate3 });
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointC[i].Rounds[1].DetailRate4 });
                                                                                list.Add(new { Value = 5, Detail = "5." + Model.pointC[i].Rounds[1].DetailRate5 });
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                        }

                                                                    </dd>
                                                                }
                                                                if (Model.pointC[i].Unit == UnitOfPoint.ระดับ_ร้อยละ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointC[i].Rounds.Count == 2))
                                                                    {
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointC[i].Rounds[1].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointC[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointC[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointC[i].Rounds[1].DetailRate1 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointC[i].Rounds[1].DetailRate2  <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointC[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                        }
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointC[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointC[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[1].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointC[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointC[i].Rounds[1].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointC[i].Rounds[0].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointC[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointC[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointC[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointC[i].Rounds[0].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointC[i].Rounds[0].DetailRate3<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointC[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointC[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointC[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointC[i].Rounds[0].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointC[i].Rounds[0].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointC[i].Rounds[0].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            if (Model.pointC[i].Rounds[0].LevelNumber >= 1)
                                                                            {
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointC[i].Rounds[0].DetailRate1 });

                                                                            }
                                                                            if (Model.pointC[i].Rounds[0].LevelNumber >= 2)
                                                                            {
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointC[i].Rounds[0].DetailRate2 });
                                                                            }
                                                                            if (Model.pointC[i].Rounds[0].LevelNumber >= 3)
                                                                            {
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointC[i].Rounds[0].DetailRate3 });
                                                                            }
                                                                            if (Model.pointC[i].Rounds[0].LevelNumber >= 4)
                                                                            {
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointC[i].Rounds[0].DetailRate4 });
                                                                            }

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointC[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                if (Model.pointC[i].Rounds[1].LevelNumber >= 1)
                                                                                {
                                                                                    list.Add(new { Value = 1, Detail = "1." + Model.pointC[i].Rounds[1].DetailRate1 });
                                                                                }
                                                                                if (Model.pointC[i].Rounds[1].LevelNumber >= 2)
                                                                                {
                                                                                    list.Add(new { Value = 2, Detail = "2." + Model.pointC[i].Rounds[1].DetailRate2 });
                                                                                }
                                                                                if (Model.pointC[i].Rounds[1].LevelNumber >= 3)
                                                                                {
                                                                                    list.Add(new { Value = 3, Detail = "3." + Model.pointC[i].Rounds[1].DetailRate3 });
                                                                                }
                                                                                if (Model.pointC[i].Rounds[1].LevelNumber >= 4)
                                                                                {
                                                                                    list.Add(new { Value = 4, Detail = "4." + Model.pointC[i].Rounds[1].DetailRate4 });
                                                                                }
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" readonly />
                                                                        }

                                                                    </dd>
                                                                    <dt class="col-3">เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfExpect)
                                                                    </dd>
                                                                    <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfData)
                                                                    </dd>
                                                                    <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @if (sumOfExpect != 0)
                                                                        {
                                                                            @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                        }
                                                                    </dd>
                                                                }
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    </dd>
                                                                }
                                                                else
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    </dd>
                                                                }
                                                                @if (de?.AttachFile != null)
                                                                {
                                                                    <dt class="col-3">ไฟล์แนบ</dt>
                                                                    <dd class="col-9">
                                                                        <a href="~/attach_files/@de?.AttachFile" target="_blank"><i class="fas fa-file-pdf fa-2x"></i></a>
                                                                    </dd>
                                                                }
                                                            } @* End ระดับ - ระดับ-ร้อยละ*@
                                                        </dl>
                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointC[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                                .ID("button")
                                                                .Text("บันทึก")
                                                                .Type(ButtonType.Success)
                                                                .UseSubmitBehavior(true)
                                                            )
                                                        }
                                                        else
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                               .ID("button")
                                                               .Text("บันทึก")
                                                               .Type(ButtonType.Normal)
                                                               .UseSubmitBehavior(false)
                                                            )
                                                        }
                                                        <input type="hidden" name="UpdateData.Id" value=@de?.Id />
                                                        <input asp-for="yearPoint" class="form-control" hidden />
                                                        <input asp-for="month" class="form-control" hidden />
                                                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                                                    </form>
                                                }
                                            </td>
                                        }
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr><th colspan="2" style="text-align:right">รวม</th><th></th><th></th><th></th><th></th><th></th></tr>
                            </tfoot>
                        </table>
                        <input asp-for="yearPoint" class="form-control" hidden />
                        <input asp-for="month" class="form-control" hidden />
                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                        @if (User.IsInRole("Admin") || User.IsInRole("Special") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000")
                           || (user.approver == true && user.OfficeId.Substring(5, 3) == "000"))
                        {
                            <input type="submit" name="Update" value="บันทึก" class="btn btn-primary" />
                        }
                        <a asp-area="" asp-controller="Results" asp-action="Index" asp-route-yearPoint="@Model.yearPoint" asp-route-selectoffice="@ViewBag.selectoffice" asp-route-month="@Model.month" class="btn btn-secondary">ยกเลิก</a>
                    </form>
                </div>
            </div>
        </div>
    }
    <!-- Plan D -->
    @if (Model.pointD != null)
    {
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">แผนงานร่วม (Joint KPI: D)</h6>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <form asp-action="Update" method="post">
                        <table class="table table-bordered" id="EPEStableD" style="width:100%;" cellspacing="0">
                            <thead>
                                <tr>
                                    <th>
                                        ที่
                                    </th>
                                    <th>
                                        ตัวชี้วัด
                                    </th>
                                    <th>
                                        <i class="fas fa-percent" title="น้ำหนักร้อยละ"></i>
                                    </th>
                                    <th>
                                        คะแนน
                                    </th>
                                    <th>
                                        เห็นชอบ
                                    </th>
                                    <th>
                                        ความเห็น
                                    </th>
                                    <th>
                                        รายละเอียด
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                @for (int i = 0; i < Model.pointD.Count(); i++)
                                {
                                    sumOfExpect = 0;
                                    sumOfData = 0;
                                    <tr>
                                        <td>
                                            @if (Model.pointD[i].SubPoint != 0)
                                            {
                                                @Model.pointD[i].Point@:.@Model.pointD[i].SubPoint
                                            }
                                            else
                                            {
                                                @Model.pointD[i].Point
                                            }
                                        </td>
                                        <td>
                                            @Model.pointD[i].Name
                                            @foreach (var item in @Model.pointD[i].DataForEvaluations)
                                            {
                                                if (item.Month == Model.month && item.OfficeId == Model.pointD[i].OwnerOfficeId)
                                                {
                                                    de = item;
                                                }
                                                if (Model.pointD[i].Unit != UnitOfPoint.ระดับ)
                                                {
                                                    if (Model.month >= 10)
                                                    {
                                                        if (item.Month <= Model.month && item.Month >= 10)
                                                        {
                                                            if (Model.pointD[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        if (item.Month == 10 || item.Month == 11 || item.Month == 12)
                                                        {
                                                            if (Model.pointD[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                        if (item.Month <= Model.month)
                                                        {
                                                            if (Model.pointD[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                sumOfData += item.Result;
                                                            }
                                                            else
                                                            {
                                                                sumOfData += item.ResultLevelRate;
                                                            }
                                                            sumOfExpect += item.Expect;
                                                        }
                                                    }
                                                }
                                            }
                                            <input type="hidden" name="UpdateData[@i].Id" value=@de?.Id />
                                            <input type="hidden" name="UpdateData[@i].poeid" value=@Model.pointD[i].Id />
                                            <input type="hidden" name="UpdateData[@i].officeid" value=@Model.pointD[i].OwnerOfficeId />
                                            @foreach (var item in @Model.pointD[i].ScoreDrafts)
                                            {
                                                if (item.LastMonth == Model.month && item.OfficeId == Model.pointD[i].OwnerOfficeId)
                                                {
                                                    sd = item;
                                                }
                                            }
                                        </td>
                                        <td>
                                            @if (!Model.pointD[i].HasSub)
                                            {
                                                @Model.pointD[i].Weight.ToString("N2")
                                            }
                                        </td>
                                        <td>
                                            @*@string.Format("{0:N4}", sd?.ScoreValue)*@
                                            @if (!Model.pointD[i].HasSub)
                                            {
                                                @sd?.ScoreValue.ToString("N4")
                                            }
                                        </td>
                                        @if (@Model.pointD[i].HasSub)
                                        {
                                            <td><input type="hidden" name="UpdateData[@i].hasSub" value="true" /></td>
                                            <td></td>
                                            <td></td>
                                        }
                                        else
                                        {
                                            if (de?.Approve == Approve.รอพิจารณา)
                                            {

                                                @if (user.OfficeId.Substring(0, 3) == "000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-danger">รอพิจารณา</label>
                                                        </div>
                                                    </td>
                                                    <td></td>
                                                }

                                            }
                                            else if (de?.Approve == Approve.หัวหน้าหน่วยงานอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000")
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 /></td>
                                                }
                                                else if (user.OfficeId.Substring(0, 3) != "000" && user.OfficeId.Substring(2, 6) != "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.หัวหน้าหน่วยงานอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <label class="form-check-label text-secondary">สท. เห็นชอบแล้ว</label>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent1" value=@de?.CommentApproveLevel1 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 /></td>
                                                }
                                                else if (user.OfficeId.Substring(2, 6) == "000000" && (user.approver ?? false))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.สภ_ผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-info">สภ. เห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent2" value=@de?.CommentApproveLevel2 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.กองผู้กำกับตัวชี้วัดอนุมัติ)
                                            {
                                                if (user.OfficeId.Substring(0, 3) == "000" && user.OfficeId != "00013000")
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.กองผู้กำกับตัวชี้วัดอนุมัติ" checked readonly />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                                else if (User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId == "00013000"))
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <input type="checkbox" class="form-check-input" name="UpdateData[@i].Approve" id="UpdateData[@i].Approve" value="@Approve.ผษ_อนุมัติ" />
                                                            <label class="form-check-label" for="UpdateData[@i].Approve">เห็นชอบ</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 /></td>
                                                }
                                                else
                                                {
                                                    <td>
                                                        <div class="form-check-inline">
                                                            <label class="form-check-label text-primary">กองกำกับเห็นชอบแล้ว</label>
                                                        </div>
                                                    </td>
                                                    <td><input type="text" class="form-control" name="UpdateData[@i].Commenent3" value=@de?.CommentApproveLevel3 readonly /></td>
                                                }
                                            }
                                            else if (de?.Approve == Approve.ผษ_อนุมัติ)
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label text-success">กรมเห็นชอบแล้ว</label>
                                                    </div>
                                                </td>
                                                <td><input type="text" class="form-control" name="UpdateData[@i].Commenent4" value=@de?.CommentApproveLevel4 readonly /></td>
                                            }
                                            else
                                            {
                                                <td>
                                                    <div class="form-check-inline">
                                                        <label class="form-check-label">ยังไม่บันทึกข้อมูล</label>
                                                    </div>
                                                </td>
                                                <td></td>
                                            }
                                            <td>
                                                @(Html.DevExtreme().Button()
                                                                //.ElementAttr("class", "button-info")
                                                                .Text("รายละเอียด")
                                                                .OnClick(@<text>
                                                                            function showInfo(data) {
                                                                            var popup = $("#detail-popup").dxPopup("instance");
                                                                            popup.option("contentTemplate", $("@("#popup-template-" + Model.pointD[i].Id)"));
                                                                            popup.show();
                                                                            }
                                                                </text>)
                                                )

                                                @using (Html.DevExtreme().NamedTemplate("popup-template-" + Model.pointD[i].Id))
                                                {
                                                    <form id="@("form" + Model.pointD[i].Id)" method="post" action="Audit\SaveAudit">
                                                        <dl class="row">
                                                            <dt class="col-3">หมายเลขตัวชี้วัด</dt>
                                                            <dd class="col-9">
                                                                @if (Model.pointD[i].SubPoint != 0)
                                                                {
                                                                    @Model.pointD[i].Point@:.@Model.pointD[i].SubPoint
                                                                }
                                                                else
                                                                {
                                                                    @Model.pointD[i].Point
                                                                }
                                                            </dd>
                                                            <dt class="col-3">ชื่อ</dt>
                                                            <dd class="col-9">
                                                                @Model.pointD[i].Name
                                                            </dd>
                                                            <dt class="col-3">น้ำหนัก</dt>
                                                            <dd class="col-9">
                                                                @Model.pointD[i].Weight.ToString("N2") %
                                                            </dd>
                                                            <dt class="col-3">เป้าหมาย</dt>
                                                            @if (Model.pointD[i].Unit == UnitOfPoint.ร้อยละ)
                                                            {
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="text" class="form-control" name="UpdateData.Result" value="@String.Format("{0:N4}", de?.Result)" disabled />
                                                                    }

                                                                </dd>
                                                                <dt class="col-3">เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfExpect)
                                                                </dd>
                                                                <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                <dd class="col-9">
                                                                    @string.Format("{0:N4}", sumOfData)
                                                                </dd>
                                                                <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                <dd class="col-9">
                                                                    @if (sumOfExpect != 0)
                                                                    {
                                                                        @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                    }
                                                                    else
                                                                    {
                                                                        <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                    }
                                                                </dd>
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                <dd class="col-9">
                                                                    @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    }
                                                                    else
                                                                    {
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    }
                                                                </dd>
                                                            }
                                                            else
                                                            {
                                                                if (Model.pointD[i].Unit == UnitOfPoint.ระดับ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointD[i].Rounds.Count == 2))
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointD[i].Rounds[1].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointD[i].Rounds[1].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointD[i].Rounds[1].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointD[i].Rounds[1].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointD[i].Rounds[1].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate1MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointD[i].Rounds[0].DetailRate1
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate2MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                2.@Model.pointD[i].Rounds[0].DetailRate2
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate3MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                3.@Model.pointD[i].Rounds[0].DetailRate3
                                                                            </dd>
                                                                        }
                                                                        else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate4MonthStop)
                                                                        {
                                                                            <dd class="col-9">
                                                                                4.@Model.pointD[i].Rounds[0].DetailRate4
                                                                            </dd>
                                                                        }
                                                                        else
                                                                        {
                                                                            <dd class="col-9">
                                                                                5.@Model.pointD[i].Rounds[0].DetailRate5
                                                                            </dd>
                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            list.Add(new { Value = 1, Detail = "1." + Model.pointD[i].Rounds[0].DetailRate1 });
                                                                            list.Add(new { Value = 2, Detail = "2." + Model.pointD[i].Rounds[0].DetailRate2 });
                                                                            list.Add(new { Value = 3, Detail = "3." + Model.pointD[i].Rounds[0].DetailRate3 });
                                                                            list.Add(new { Value = 4, Detail = "4." + Model.pointD[i].Rounds[0].DetailRate4 });
                                                                            list.Add(new { Value = 5, Detail = "5." + Model.pointD[i].Rounds[0].DetailRate5 });

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointD[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointD[i].Rounds[1].DetailRate1 });
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointD[i].Rounds[1].DetailRate2 });
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointD[i].Rounds[1].DetailRate3 });
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointD[i].Rounds[1].DetailRate4 });
                                                                                list.Add(new { Value = 5, Detail = "5." + Model.pointD[i].Rounds[1].DetailRate5 });
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                        }

                                                                    </dd>
                                                                }
                                                                if (Model.pointD[i].Unit == UnitOfPoint.ระดับ_ร้อยละ)
                                                                {
                                                                    if ((3 < Model.month) && (Model.month < 10) && (Model.pointD[i].Rounds.Count == 2))
                                                                    {
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointD[i].Rounds[1].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointD[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointD[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointD[i].Rounds[1].DetailRate1 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointD[i].Rounds[1].DetailRate2  <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointD[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                        }
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointD[i].Rounds[1].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointD[i].Rounds[1].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[1].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointD[i].Rounds[1].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointD[i].Rounds[1].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    else
                                                                    {
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 1)
                                                                        {
                                                                            <dd class="col-9">
                                                                                1.@Model.pointD[i].Rounds[0].DetailRate1<br />
                                                                                @string.Format("{0:N4}", de?.Expect)
                                                                            </dd>
                                                                        }
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 2)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointD[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointD[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 3)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointD[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointD[i].Rounds[0].DetailRate2 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointD[i].Rounds[0].DetailRate3<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                        if (Model.pointD[i].Rounds[0].LevelNumber == 4)
                                                                        {
                                                                            if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate1MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    1.@Model.pointD[i].Rounds[0].DetailRate1<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate2MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    2.@Model.pointD[i].Rounds[0].DetailRate2<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else if (new DateTime(DateTime.Now.Year, Model.month, 28) <= Model.pointD[i].Rounds[0].Rate3MonthStop)
                                                                            {
                                                                                <dd class="col-9">
                                                                                    3.@Model.pointD[i].Rounds[0].DetailRate3 <br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }
                                                                            else
                                                                            {
                                                                                <dd class="col-9">
                                                                                    4.@Model.pointD[i].Rounds[0].DetailRate4<br />
                                                                                    @string.Format("{0:N4}", de?.Expect)
                                                                                </dd>
                                                                            }

                                                                        }
                                                                    }
                                                                    <dt class="col-3">ผลการปฏิบัติราชการ</dt>
                                                                    <dd class="col-9">
                                                                        @{
                                                                            List<Object> list = new List<object>();
                                                                            if (Model.pointD[i].Rounds[0].LevelNumber >= 1)
                                                                            {
                                                                                list.Add(new { Value = 1, Detail = "1." + Model.pointD[i].Rounds[0].DetailRate1 });

                                                                            }
                                                                            if (Model.pointD[i].Rounds[0].LevelNumber >= 2)
                                                                            {
                                                                                list.Add(new { Value = 2, Detail = "2." + Model.pointD[i].Rounds[0].DetailRate2 });
                                                                            }
                                                                            if (Model.pointD[i].Rounds[0].LevelNumber >= 3)
                                                                            {
                                                                                list.Add(new { Value = 3, Detail = "3." + Model.pointD[i].Rounds[0].DetailRate3 });
                                                                            }
                                                                            if (Model.pointD[i].Rounds[0].LevelNumber >= 4)
                                                                            {
                                                                                list.Add(new { Value = 4, Detail = "4." + Model.pointD[i].Rounds[0].DetailRate4 });
                                                                            }

                                                                            if ((3 < Model.month) && (Model.month < 10) && (Model.pointD[i].Rounds.Count == 2))
                                                                            {
                                                                                list.Clear();
                                                                                if (Model.pointD[i].Rounds[1].LevelNumber >= 1)
                                                                                {
                                                                                    list.Add(new { Value = 1, Detail = "1." + Model.pointD[i].Rounds[1].DetailRate1 });
                                                                                }
                                                                                if (Model.pointD[i].Rounds[1].LevelNumber >= 2)
                                                                                {
                                                                                    list.Add(new { Value = 2, Detail = "2." + Model.pointD[i].Rounds[1].DetailRate2 });
                                                                                }
                                                                                if (Model.pointD[i].Rounds[1].LevelNumber >= 3)
                                                                                {
                                                                                    list.Add(new { Value = 3, Detail = "3." + Model.pointD[i].Rounds[1].DetailRate3 });
                                                                                }
                                                                                if (Model.pointD[i].Rounds[1].LevelNumber >= 4)
                                                                                {
                                                                                    list.Add(new { Value = 4, Detail = "4." + Model.pointD[i].Rounds[1].DetailRate4 });
                                                                                }
                                                                            }

                                                                            ViewBag.SelectLevel = new SelectList(list, "Value", "Detail", de == null ? 1 : (int)de.Result);
                                                                        }
                                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel"></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" />
                                                                        }
                                                                        else
                                                                        {
                                                                            <select name="UpdateData.Result" class="form-control" asp-items="ViewBag.SelectLevel" disabled></select>
                                                                            <br />
                                                                            <input type="text" class="form-control" name="UpdateData.ResultLevelRate" value="@String.Format("{0:N4}", de?.ResultLevelRate)" readonly />
                                                                        }

                                                                    </dd>
                                                                    <dt class="col-3">เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfExpect)
                                                                    </dd>
                                                                    <dt class="col-3">ผลการปฏิบัติสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @string.Format("{0:N4}", sumOfData)
                                                                    </dd>
                                                                    <dt class="col-3">ร้อยละ ผลสะสม/เป้าหมายสะสม</dt>
                                                                    <dd class="col-9">
                                                                        @if (sumOfExpect != 0)
                                                                        {
                                                                            @string.Format("{0:N4}", sumOfData / sumOfExpect * 100) @: %
                                                                        }
                                                                        else
                                                                        {
                                                                            <span>เป้าหมายสะสม ไม่ได้บันทึก</span>
                                                                        }
                                                                    </dd>
                                                                }
                                                                <dt class="col-3">วันที่แล้วเสร็จ</dt>
                                                                @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) />
                                                                    </dd>
                                                                }
                                                                else
                                                                {
                                                                    <dd class="col-9">
                                                                        <input type="date" class="form-control" name="UpdateData.Completed" value=@(de?.Completed ?? new DateTime(DateTime.Now.Year, Model.month, 28).ToString("yyyy-MM-dd", CultureInfo.CreateSpecificCulture("en-US"))) readonly />
                                                                    </dd>
                                                                }
                                                                @if (de?.AttachFile != null)
                                                                {
                                                                    <dt class="col-3">ไฟล์แนบ</dt>
                                                                    <dd class="col-9">
                                                                        <a href="~/attach_files/@de?.AttachFile" target="_blank"><i class="fas fa-file-pdf fa-2x"></i></a>
                                                                    </dd>
                                                                }
                                                            } @* End ระดับ - ระดับ-ร้อยละ*@
                                                        </dl>
                                                        @if ((User.IsInRole("Admin") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000" && Model.pointD[i].AuditOffice.Code == user.OfficeId)) && de?.Approve < Approve.ผษ_อนุมัติ)
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                                .ID("button")
                                                                .Text("บันทึก")
                                                                .Type(ButtonType.Success)
                                                                .UseSubmitBehavior(true)
                                                            )
                                                        }
                                                        else
                                                        {
                                                            @(Html.DevExtreme().Button()
                                                               .ID("button")
                                                               .Text("บันทึก")
                                                               .Type(ButtonType.Normal)
                                                               .UseSubmitBehavior(false)
                                                            )
                                                        }
                                                        <input type="hidden" name="UpdateData.Id" value=@de?.Id />
                                                        <input asp-for="yearPoint" class="form-control" hidden />
                                                        <input asp-for="month" class="form-control" hidden />
                                                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                                                    </form>
                                                }
                                            </td>
                                        }
                                    </tr>
                                }
                            </tbody>
                            <tfoot>
                                <tr><th colspan="2" style="text-align:right">รวม</th><th></th><th></th><th></th><th></th><th></th></tr>
                            </tfoot>
                        </table>
                        <input asp-for="yearPoint" class="form-control" hidden />
                        <input asp-for="month" class="form-control" hidden />
                        <input type="hidden" name="selectoffice" value="@ViewBag.selectoffice" />
                        @if (User.IsInRole("Admin") || User.IsInRole("Special") || (User.IsInRole("Manager") && user.OfficeId.Substring(0, 3) == "000")
                           || (user.approver == true && user.OfficeId.Substring(5, 3) == "000"))
                        {
                            <input type="submit" name="Update" value="บันทึก" class="btn btn-primary" />
                        }
                        <a asp-area="" asp-controller="Results" asp-action="Index" asp-route-yearPoint="@Model.yearPoint" asp-route-selectoffice="@ViewBag.selectoffice" asp-route-month="@Model.month" class="btn btn-secondary">ยกเลิก</a>
                    </form>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <partial name="_dataTableScript_Audit" />
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}
